# ğŸ—ï¸ Variables
APP_NAME = go-hello-lambda
FUNCTION_NAME = go-hello-lambda
ARCH = amd64        # or arm64
ZIP_FILE = function.zip
BINARY = bootstrap
REGION = sa-east-1  # change to your region
ROLE_ARN = arn:aws:iam::

# ğŸ§¹ Cleanup build artifacts
clean:
	rm -f $(BINARY) $(ZIP_FILE)

# âš™ï¸ Build binary for AWS Lambda (Amazon Linux 2)
build:
	GOOS=linux GOARCH=$(ARCH) CGO_ENABLED=0 go build -o $(BINARY) main.go
	file $(BINARY)

# ğŸ“¦ Package for Lambda
package: clean build
	zip $(ZIP_FILE) $(BINARY)
	@echo "âœ… Packaged $(ZIP_FILE)"

# â˜ï¸ Create Lambda (run only once)
create:
	aws lambda create-function \
	  --function-name $(FUNCTION_NAME) \
	  --runtime provided.al2 \
	  --role $(ROLE_ARN) \
	  --handler $(BINARY) \
	  --zip-file fileb://$(ZIP_FILE) \
	  --architectures $(ARCH) \
	  --region $(REGION)

# ğŸ”„ Update code in existing Lambda
deploy: package
	aws lambda update-function-code \
	  --function-name $(FUNCTION_NAME) \
	  --zip-file fileb://$(ZIP_FILE) \
	  --region $(REGION)
	@echo "ğŸš€ Deployed to Lambda: $(FUNCTION_NAME)"
